// ==UserScript==
// @name         Stack User profiles
// @description  Make use of the space like before.
// @version      1.5
//
// @namespace    scratte-fiddlings
// @author       Scratte (https://stackoverflow.com/users/12695027)
//
// @include      /^https://(meta\.)?askubuntu\.com/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @include      /^https://(meta\.)?mathoverflow\.net/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @include      /^https://(meta\.)?stackoverflow\.com/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @include      /^https://(meta\.)?superuser\.com/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @include      /^https://(meta\.)?serverfault\.com/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @include      /^https://stackapps\.com/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @include      /^https://[^/]+\.stackexchange\.com/users/(?:-)?\d+/[^/?]+(?:\?tab=profile)?$/
// @exclude      *://api.stackexchange.com/*
// @exclude      *://data.stackexchange.com/*
// @exclude      *://elections.stackexchange.com/*
// @exclude      *://openid.stackexchange.com/*
// @exclude      *://blog.*.com/*
// @exclude      *://chat.*.com/*
// @exclude      *://contests.*.com/*
//
// @grant        none
// ==/UserScript==
!function(){"use strict";function l(e){let t=e.title;return t||(t=e.firstElementChild?.title,t||e.querySelector(".date_brick")?.title)}function f(e,t){const n=document.createElement("h3");n.textContent="Activity",n.style.color="var(--theme-primary-400)",n.style.margin="0";const r=document.createElement("ul");t?r.append(i("⇑",l(e||t),"Most recent"),i("⇓",l(t),"Very first"),i(" "," "),i("⌚",function(){const e=(new Date).toISOString();return e.substr(0,10)+" "+e.substr(11,8)+e.substr(23)}(),"Current time")):r.append(i(" ","❌ none")),r.style.lineHeight="1.5",r.style.marginLeft="15px";const s=document.createElement("div");return s.style.marginLeft="2px",s.style.whiteSpace="nowrap",s.append(n,r),s}function i(e,t,n){const r=document.createElement("li");return r.textContent=t,r.style.listStyleType=`"${e} "`,r.title=n,r}async function h(e){var t=window["location"],t=t.pathname;const n=await fetch(`${t}?tab=activity&sort=all&page=${e}`);e=await n.text();return(new DOMParser).parseFromString(e,"text/html")}const e=document.getElementById("user-card");if(!e)return;e.classList.remove("mb48"),e.classList.add("mb32");var t=e.children;if(t.length<2)return;var n=t[0],t=t[1];const y=function(e){const t=e.firstElementChild?.children;if(t||!(t.length<2)){if(StackExchange?.options.user.userId?.toString()===window.location.pathname.split("/")[2])if(3<t.length)t[3].remove();else{const s=e.querySelector("a");s&&"Edit profile"===s.textContent.trim()&&s.remove()}const n=t[1];e=n.cloneNode([!0]);const r=n.children;if(!(r.length<4)){for(let e=3;0<e;e--)r[e].remove();return r[0].classList.remove("flex--item"),r[0].classList.add("d-flex"),r[0].firstElementChild.style.paddingRight="5px",r[0].firstElementChild.style.marginTop="-2px",e}}}(n);t=function(e){var t=e.querySelector("h3"),n=e.querySelectorAll("div:is(#user-card > div > div)"),r=t=>e=>e.classList.contains(t);const s=[...n].find(r("overflow-x-hidden")),l=[...n].find(r("my16"));r=[...n].find(e=>e!==s&&e!==l);const i=document.createElement("div");i.classList.add("d-flex","fl-grow1","fd-column","mr48"),i.append(r),t&&i.append(t);const a=document.createElement("div");if(a.style.minWidth="150px",y){const d=y.children;d[0].remove(),d[0].remove(),a.append(y)}else{const c=document.createElement("div");c.classList.add("fs-body3","fc-dark"),c.textContent="0";const m=document.createElement("div");m.classList.add("flex--item"),m.append(c);const p=m.cloneNode([!0]);m.append("answers"),p.append("questions");const u=document.createElement("div");u.classList.add("d-flex","flex__allcells6","fw-wrap","gs4","fc-light","px4","wmx2"),u.append(m,p),a.append(u)}if(s&&(s.classList.remove("mt24"),s.classList.add("mt12"),s.style.maxHeight=t?"211px":"235px",s.style.paddingRight="15px",s.style.marginRight="-15px",i.append(s)),l){n=l.children,r=n.length;const f=0<r?n[0]:null,h=1<r?n[1]:null;if(f){f.classList.remove("mr48");const g=f.querySelector("ul");h&&(g.append(...h.querySelectorAll("li")),h.remove()),a.append(l)}}const o=document.createElement("div");return o.classList.add("d-flex"),i.classList.add("flex--item"),a.classList.add("flex--item"),o.append(i,a),e.classList.remove("mt16"),e.append(o),{elementToAppend:a,headerPresent:!!t,elementToAdjust:s}}(t,y);["badges","top-tags","top-posts"].forEach(e=>{const t=document.getElementById(e);if(t&&(t.classList.remove("mb48"),t.classList.add("mb32"),"badges"===e)){const n=t.parentElement?.parentElement;n&&(n.style.width="revert",n.style.maxWidth="revert")}}),document.querySelectorAll(".ta-right").forEach(e=>{e.classList.remove("mb24")}),function(){const e=document.createElement("style");e.innerText=`body.user-page #user-card + div > div.flex--item.fl1:nth-child(2) { display: flex; flex-direction: column; } body.user-page #top-tags { order: 1; } body.user-page #top-posts { order: 2; } body.user-page #badges { order: 3; } .profile-badges .fl1:nth-child(2) { display: flex; align-items: center; } .profile-badges .fs-title { float: left; margin-right: 4px; } .spotAward { transform: scale(0.75,0.75);`,document.head.appendChild(e)}(),function(){var e=document.querySelector(".profile-placeholder--image");const t=e&&e.parentElement;t&&(t.classList.remove("mt64","pt32"),t.classList.add("mb24"))}(),async function({elementToAppend:n,headerPresent:r,elementToAdjust:s}){var e=t=>new Promise(e=>setTimeout(e,1e3*t)),t=e=>{e=e.querySelectorAll(".date");if(e)return e[e.length-1]},l=e=>{for(const n of e.querySelectorAll(".history-table tr")){var t=n.children;if(1<t.length&&"awarded"!==t[1].textContent)return t[0]}},i=(e,t)=>{n.append(f(e,t));t=parseInt(window.getComputedStyle(n).height);s&&(s.style.maxHeight=t-88+(r?0:30)+"px")};let a=1,o,d,c;const m=await h(a++);var p=m.querySelector(".s-pagination");if(!p)return d=l(m),c=t(m),i(d,c);{let e=p.lastElementChild;e&&"Next"===e.textContent.trim()&&(e=e.previousElementSibling),o=e.textContent.trim()}for(d=l(m);!d&&a<o;){await e(1+Math.random()+.1);var u=await h(a++);d=l(u),a===o&&(c=t(u))}a!==o&&(await e(1+Math.random()+.1),p=await h(o),c=t(p)),i(d,c)}(t)}();